---
name: ansible-content-action
description: This is a monolithic action for Ansible contnet testing
author: Sagar Paul
inputs:
  ansible_galaxy_api_key: # string
    description: "The Galaxy api key"
    required: false
  gh_token: # string
    description: "The GH token"
    required: false
runs:
  using: composite
  steps:
    # run ansible-lint
    - name: Run ansible-lint
      if: ${{ github.event_name == 'pull_request' }}
      uses: KB-perByte/ansible-content-action/.github/actions/ansible-lint@main

    # run sanity with declared matrix
    - name: Run sanity
      if: ${{ github.event_name == 'pull_request' }}
      uses: KB-perByte/ansible-content-action/.github/actions/sanity@main

    # - name: Run ack
    #   if: ${{ github.event_name == 'pull_request' }}
    #   uses: KB-perByte/ansible-content-action/.github/actions/ack@main
    #   env:
    #     GITHUB_TOKEN: ${{ env.GITHUB_TOKEN }}

    # - name: Run ack
    #   if: ${{ github.job == 'ack' }}
    #   uses: KB-perByte/devtools/.github/workflows/ack.yml@main

    # run release galaxy on event publish
    - name: Release Galaxy"
      if: ${{ (github.event_name == 'release') && (github.event == 'published') }}
      uses: KB-perByte/ansible-content-action/.github/actions/release-galaxy@main
      with:
        ansible_galaxy_api_key: ${{ inputs.ansible_galaxy_api_key }}
